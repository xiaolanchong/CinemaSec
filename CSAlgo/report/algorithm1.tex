%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\section{Подходы к решению задачи. Алгоритм 1.}
\label{sec:algorithm1}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%
С самого начала мы отказались от методов применяемых в системе \orwell2, поскольку у нас нет стационарного фона из-за неравномерного и мерцающего освещения. Как следствие, мы отказались (пока) от слежения за человеком, перемещающимся по залу, пересаживающимся с кресла на кресло или покидающим зал. Этот отказ мотивирован ещё и тем, что у нас зал покрывается несколькими камерами, поэтому движущийся объект нужно ``передавать'' от камеры к камере, а это ведёт к существенному усложнению всей технологии работы. Однако во время практически любого сеанса бывают довольно продолжительные промежутки, когда фон можно считать почти постоянным. Поэтому в дальнейшем, имеет смысл вернуться к задаче прослеживания перемещения отдельных людей.

Принимая во внимание сроки исполнения работы и наличия серьёзных проблем, перечисленных выше, мы сформулировали следующий подход к решению задачи подсчёта числа людей. Этот подход был реализован в первой версии алгоритма (\texttt{CSAlgo1.dll}), а некоторые идеи были в дальнейшем использованы во второй версии алгоритма.

\begin{enumerate}
\itemsep = -\parsep %\advance\leftskip by -1em
\item Алгоритм работает только в области покрывающей примерно 60\% спинки кресла и расположенной в верхней её части. Только эта часть кресла видна при любом расположении кресла относительно камеры;
\item Перед началом работы производится съёмка пустого зала, освещённого кинопроектором, в котором не заправлена пленка. Таким образом, мы получаем пустые кресла, освещённые примерно так же, как это происходит во время сеанса. Полученное методом накопления (для снижения шумов) изображение называется \emph{статическим фоном};
\item Соответствующие кресла на статическом фоне обводятся в специальной программе. В результате мы имеем набор замкнутых кривых, которые очерчивают \emph{зону наблюдения} в пределах каждого кресла, т.е. получается привязка кресел к определённым областям изображения;
\item Во время работы мы сравниваем статический фон с текущим кадром в пределах зон наблюдения. В результате вычисляется значение разности между текущим изображением кресла и его изображением на статическом фоне, полученное из \emph{нормализованной кросс-корреляции}. Значение разности мы называем \emph{статической корреляцией}, хотя это и не совсем математически корректно, поскольку разность тем меньше чем более похожи изображения. Если разность меньше порога, то кресло пустое, иначе кресло занято вещами или человеком. Следует отметить, что нормализованная кросс-корреляция довольно точно отделяет пустые кресла от непустых. Её главное достоинство слабая чувствительность к резким перепадам яркости;
\item Чтобы отличать людей от одежды одной статической корреляции недостаточно. К счастью люди, даже самые флегматичные, рано или поздно меняют позу. Чтобы обнаруживать движения людей, мы одновременно накапливаем два изображения. Оба изображения складываются в определённой пропорции с предыдущими кадрами. В первом изображении доля предыдущих кадров мала, а текущего велика. Во втором изображении наоборот, доля предыдущих кадров велика, а текущего мала. Таким образом, второе изображение запаздывает по отношению к первому изображению. Если человек начинает двигаться в кресле, то интегральное значение разности между обоими изображениями становится ненулевой. Эту разность мы называем \emph{динамической корреляцией}, хотя, как и в случае статической корреляции, это и не совсем математически корректно. Динамическая корреляция также вычисляется из нормализованной кросс-корреляции, т.е. она слабо-чувствительна к вариациям засветки;
\item Для каждого кресла мы подсчитываем два типа интервалов. \emph{Статические интервалы} характеризуют временные промежутки когда статическая корреляция превышала пороговое значение, т.е. кресло было чем-то или кем-то занято. Мы считаем, что кресло может быть занято человеком, если суммарная продолжительность статических интервалов составляет существенную часть полной продолжительности сеанса;
\item Внутри статических интервалов могут находиться несколько динамических интервалов. \emph{Динамическим интервалом} мы называем временной промежуток, в течение которого значение динамической корреляции превышало пороговое значение. Слишком короткие динамические интервалы трактуются как случайные и не принимаются во внимание, что задаётся в настройках;
\item Если статические интервалы наблюдения данного кресла достаточно продолжительны и объект, занимающий кресло пошевелился несколько раз за сеанс, то мы считаем объект человеком и увеличиваем счётчик;
\item Если суммарная продолжительность динамических интервалов соизмерима с продолжительностью соответствующих статических интервалов, то мы не считаем объект человеком. Последнее условие полезно в следующей ситуации. Допустим, на сидении кресла находится сумка, а само кресло определяется как пустое. Когда человек сидящий на соседнем кресле начинает копошиться в сумке, то он наклоняется так, что ранее пустое кресло теперь определяется как занятое и в тоже время там наблюдается активное движение. Иными словами, период занятости соизмерим с периодом активности, что не является признаком человека сидящего в данном кресле. 
\end{enumerate}

В данном описании мы, естественно, опустили ряд важных деталей реализации, однако нами были упомянуты все основные пункты первой версии алгоритма.

Несмотря на свою очевидную простоту, алгоритм выдаёт вполне разумные результаты. Очевидный недостаток первой версии чрезмерный эмпиризм в подборе параметров алгоритма. В настоящее время нами реализована вторая версия алгоритма (см. далее). Во второй версии мы также проводим анализ только в пределах спинки кресла. Однако теперь наш анализ опирается на более строгий математический подход, включающий в себя процедуру обучения на тестовых видеопоследовательностях.
